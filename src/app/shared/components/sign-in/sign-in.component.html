<div class="text-center relative">
  <button (click)="closeModal.emit()" class="absolute top-0 right-0 p-2 text-muted-foreground hover:text-foreground focus:outline-none">
    <span class="material-symbols-outlined">close</span>
  </button>
  <img src="/assets/logo.png" alt="eTalente Logo" class="h-8 w-8 mx-auto mb-2"/>
  <h3 class="text-2xl font-bold mb-2">eTalente</h3>

  <!-- Input State -->
  <ng-container *ngIf="modalState === 'input'">
    <p class="text-muted-foreground mb-6">Enter your email to receive a magic link</p>
    <form #signInForm="ngForm" (ngSubmit)="onSubmit(signInForm)">
      <div class="mb-4">
        <input
          type="email"
          name="email"
          [(ngModel)]="email"
          placeholder="you@example.com"
          required
          pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$"
          #emailInput="ngModel"
          [class.border-destructive]="emailInput.invalid && emailInput.touched"
          class="w-full px-4 py-3 bg-background border border-border rounded-md text-foreground focus:ring-0 focus:border-primary focus:shadow-input-focus transition-shadow duration-200"
        />
        <p *ngIf="emailInput.invalid && emailInput.touched" class="mt-1 text-sm text-destructive">Please enter a valid email address.</p>
      </div>
      <div class="text-left mb-4">
        <label class="flex items-center">
          <input type="checkbox" [(ngModel)]="rememberMe" name="rememberMe" class="h-4 w-4 rounded border-border bg-transparent text-primary focus:ring-primary"/>
          <span class="ml-2 text-sm text-muted-foreground">Remember Me</span>
        </label>
      </div>
      <button type="submit" [disabled]="!signInForm.valid" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-primary-foreground bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-primary transition-all duration-300 ease-in-out disabled:opacity-50">
        Send Magic Link
      </button>
      <p class="text-xs text-muted-foreground mt-4">
        By continuing, you agree to our
        <a href="#" target="_blank" class="text-primary hover:underline">Terms and Conditions</a> and
        <a href="#" target="_blank" class="text-primary hover:underline">Privacy Policy</a>.
      </p>
    </form>
    <p class="text-sm text-muted-foreground mt-6">
      Don't have an account?
      <a routerLink="/sign-up" (click)="closeModal.emit()" class="text-primary hover:underline">Create Account</a>
    </p>
  </ng-container>

  <!-- Sent State -->
  <ng-container *ngIf="modalState === 'sent'">
    <div class="py-8">
      <span class="material-symbols-outlined text-primary text-6xl mb-4">check_circle</span>
      <p class="text-lg font-semibold text-foreground mb-2">Magic Link Sent!</p>
      <p class="text-muted-foreground">Please check your email at <span class="font-medium text-foreground">{{ email }}</span> to complete your login.</p>
      <button (click)="resetState()" class="mt-6 text-primary hover:underline focus:outline-none">Send to a different email?</button>
    </div>
  </ng-container>

  <!-- Error State -->
  <ng-container *ngIf="modalState === 'error'">
    <div class="py-8">
      <span class="material-symbols-outlined text-destructive text-6xl mb-4">error</span>
      <p class="text-lg font-semibold text-foreground mb-2">Login Failed</p>
      <p class="text-muted-foreground mb-4">{{ errorMessage }}</p>
      <button (click)="resetState()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-primary-foreground bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-primary transition-all duration-300 ease-in-out">
        Try Again
      </button>
    </div>
  </ng-container>

  <!-- User Not Found State -->
  <ng-container *ngIf="modalState === 'userNotFound'">
    <div class="py-8 text-center">
      <span class="material-symbols-outlined text-info text-6xl mb-4">person_off</span>
      <p class="text-lg font-semibold text-foreground mb-2">User Not Found</p>
      <p class="text-muted-foreground mb-4">The email address <strong>{{ email }}</strong> is not registered. Would you like to create an account?</p>
      <div class="flex flex-col gap-4">
        <a routerLink="/sign-up" (click)="closeModal.emit()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-primary-foreground bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-primary transition-all duration-300 ease-in-out">
          Create Account
        </a>
        <button (click)="resetState()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-muted-foreground bg-muted hover:bg-muted/80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-primary transition-all duration-300 ease-in-out">
          Try a Different Email
        </button>
      </div>
    </div>
  </ng-container>
</div>
