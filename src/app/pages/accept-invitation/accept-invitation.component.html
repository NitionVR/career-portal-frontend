<div class="flex min-h-screen items-center justify-center p-6 sm:p-8 md:p-12 bg-background">
  <div class="w-full max-w-lg bg-card p-8 rounded-xl shadow-lg">

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
      <p class="mt-4 text-muted-foreground">Validating your invitation...</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage && !isLoading" class="text-center">
      <span class="material-symbols-outlined text-destructive text-6xl mb-4">error</span>
      <h1 class="text-2xl font-bold text-foreground mb-2">Invitation Invalid</h1>
      <p class="text-muted-foreground mb-6" role="alert">{{ errorMessage }}</p>
      <a routerLink="/" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-primary-foreground bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background focus:ring-primary transition-all duration-300 ease-in-out">
        Go to Homepage
      </a>
    </div>

    <!-- Form View -->
    <ng-container *ngIf="!isLoading && !errorMessage">
      <div class="text-center mb-8">
        <img src="/assets/logo.png" alt="eTalente Logo" class="h-12 w-12 mx-auto mb-4"/>
        <h1 class="text-3xl font-bold text-foreground mb-2">Join Your Team</h1>
        <p *ngIf="invitationDetails" class="text-muted-foreground">
          You have been invited by <span class="font-semibold text-foreground">{{ invitationDetails.invitedBy }}</span> to join <span class="font-semibold text-foreground">{{ invitationDetails.organization }}</span>.
        </p>
        <p class="text-muted-foreground">Create your account to continue.</p>
      </div>

      <form [formGroup]="acceptForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-muted-foreground mb-1" for="firstName">First Name <span class="text-destructive">*</span></label>
            <input id="firstName" formControlName="firstName" type="text" autocomplete="given-name" class="w-full px-4 py-3 bg-background border rounded-md" [class.border-destructive]="hasError('firstName')" [class.border-border]="!hasError('firstName')"/>
            <p *ngIf="hasError('firstName')" class="mt-1 text-sm text-destructive">{{ getErrorMessage('firstName') }}</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-muted-foreground mb-1" for="lastName">Last Name <span class="text-destructive">*</span></label>
            <input id="lastName" formControlName="lastName" type="text" autocomplete="family-name" class="w-full px-4 py-3 bg-background border rounded-md" [class.border-destructive]="hasError('lastName')" [class.border-border]="!hasError('lastName')"/>
            <p *ngIf="hasError('lastName')" class="mt-1 text-sm text-destructive">{{ getErrorMessage('lastName') }}</p>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-muted-foreground mb-1" for="username">Username <span class="text-destructive">*</span></label>
          <input id="username" formControlName="username" type="text" autocomplete="username" class="w-full px-4 py-3 bg-background border rounded-md" [class.border-destructive]="hasError('username')" [class.border-border]="!hasError('username')"/>
          <p *ngIf="hasError('username')" class="mt-1 text-sm text-destructive">{{ getErrorMessage('username') }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-muted-foreground mb-1" for="contactNumber">Contact Number <span class="text-destructive">*</span></label>
          <div class="phone-input-wrapper">
              <ngx-intl-tel-input
                [cssClass]="'custom-phone-input'"
                [preferredCountries]="[CountryISO.UnitedStates, CountryISO.UnitedKingdom, CountryISO.SouthAfrica]"
                [enableAutoCountrySelect]="true"
                [enablePlaceholder]="true"
                [searchCountryFlag]="true"
                [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                [selectFirstCountry]="false"
                [selectedCountryISO]="CountryISO.UnitedStates"
                [maxLength]="15"
                [phoneValidation]="true"
                [separateDialCode]="true"
                [numberFormat]="PhoneNumberFormat.International"
                formControlName="contactNumber">
              </ngx-intl-tel-input>
          </div>
          <p *ngIf="hasError('contactNumber')" class="mt-1 text-sm text-destructive">{{ getErrorMessage('contactNumber') }}</p>
        </div>

        <button type="submit" [disabled]="isSubmitting || acceptForm.invalid" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-primary-foreground bg-primary hover:bg-primary-hover disabled:opacity-50">
          <span *ngIf="!isSubmitting">Create Account & Join</span>
          <span *ngIf="isSubmitting">Processing...</span>
        </button>
      </form>
    </ng-container>

  </div>
</div>
