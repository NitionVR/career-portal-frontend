<section class="py-8 sm:py-12">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold tracking-tight">Audit Log</h1>
      <p class="text-lg text-muted-foreground mt-1">View state changes for your job posts.</p>
    </div>

    <div *ngIf="postsError" class="p-4 bg-destructive/10 text-destructive border border-destructive/20 rounded-md mb-6">{{ postsError }}</div>
    <div *ngIf="isLoadingPosts" class="flex items-center justify-center py-6 glassmorphism rounded-xl mb-6">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      <p class="ml-3 text-primary">Loading job posts...</p>
    </div>

    <div class="glassmorphism rounded-xl p-6 mb-6" *ngIf="jobPosts?.content?.length">
      <label class="block text-sm font-medium text-muted-foreground mb-2">Select job post</label>
      <select class="w-full px-4 py-3 bg-background border border-border rounded-md text-foreground focus:ring-0 focus:border-primary focus:shadow-input-focus transition-shadow duration-200" [ngModel]="selectedJobPostId" (ngModelChange)="selectPost($event)">
        <option [ngValue]="null">-- Choose a job post --</option>
        <option *ngFor="let jp of jobPosts!.content!" [ngValue]="jp.id">{{ jp.title }} ({{ jp.status }})</option>
      </select>
      <div class="flex items-center justify-between mt-4">
        <button class="px-4 py-2 text-sm font-semibold text-primary-foreground bg-primary rounded-full hover:bg-primary-hover transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed" (click)="prevPostsPage()" [disabled]="page === 0">
          <span class="material-symbols-outlined mr-2">arrow_back</span> Previous
        </button>
        <div class="text-sm text-muted-foreground">Page {{ (jobPosts!.number || 0) + 1 }} of {{ jobPosts!.totalPages || 1 }}</div>
        <button class="px-4 py-2 text-sm font-semibold text-primary-foreground bg-primary rounded-full hover:bg-primary-hover transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed" (click)="nextPostsPage()" [disabled]="jobPosts!.last">
          Next <span class="material-symbols-outlined ml-2">arrow_forward</span>
        </button>
      </div>
    </div>

    <div *ngIf="selectedJobPostId" class="glassmorphism rounded-xl p-6">
      <h2 class="text-xl font-semibold text-foreground mb-4">State History</h2>
      <div *ngIf="auditError" class="p-4 bg-destructive/10 text-destructive border border-destructive/20 rounded-md mb-4">{{ auditError }}</div>
      <div *ngIf="isLoadingAudit" class="flex items-center justify-center py-6">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        <p class="ml-3 text-primary">Loading audit history...</p>
      </div>
      <div *ngIf="!isLoadingAudit && audits.length === 0" class="p-6 border border-border rounded-md bg-card text-muted-foreground text-center">No state changes recorded.</div>

      <div *ngIf="!isLoadingAudit && audits.length" class="overflow-x-auto border border-border rounded-md">
        <table class="min-w-full text-sm divide-y divide-border">
          <thead class="bg-muted">
            <tr>
              <th class="text-left p-4 text-muted-foreground uppercase tracking-wider">Changed At</th>
              <th class="text-left p-4 text-muted-foreground uppercase tracking-wider">Changed By</th>
              <th class="text-left p-4 text-muted-foreground uppercase tracking-wider">From</th>
              <th class="text-left p-4 text-muted-foreground uppercase tracking-wider">To</th>
              <th class="text-left p-4 text-muted-foreground uppercase tracking-wider">Reason</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border">
            <tr *ngFor="let a of audits" class="hover:bg-white/5 transition-colors">
              <td class="p-4 whitespace-nowrap text-foreground">{{ a.changedAt | date:'medium' }}</td>
              <td class="p-4 whitespace-nowrap text-foreground">{{ a.changedByEmail || '—' }}</td>
              <td class="p-4 whitespace-nowrap text-foreground">{{ a.fromStatus }}</td>
              <td class="p-4 whitespace-nowrap text-foreground">{{ a.toStatus }}</td>
              <td class="p-4 text-foreground">{{ a.reason || '—' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>